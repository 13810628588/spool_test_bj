<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="The Matrix Components Framework">
        <meta name="author" content="LY">
        <title>中国平安</title>
        <link rel="shortcut icon" href="assets/self-owned/ico/favicon.png">
        <link rel="stylesheet" type="text/css" href="assets/reference/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="assets/reference/flat-ui/css/flat-ui.css">
        <link rel="stylesheet" type="text/css" href="assets/reference/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="assets/self-owned/css/matrix.css">

        <style type="text/css">
            #pinganlogo {
                display: block;
                position: relative;
                margin: auto;
            }

            .img_container_div {
                margin: auto;
                /*                margin-left: 300px;
                                          margin-right: 0px;;*/
                width: 100%;
                /*margin:0px;*/
                /*padding-top:0px;*/
            }

            .img_div {
                margin-right: 0px;
                margin-left: 0px;
                padding: 0px;
                width: 60px;
                height: 60px;
            }

            .img_size {
                margin: 0px;
                padding: 0px;
                width: 60px;
                height: 60px;
                border: 2px solid grey;
                -webkit-transition: all .2s ease-in-out;
                -o-transition: all .2s ease-in-out;
                transition: all .2s ease-in-out;
            }
        </style>
    </head>

    <body>

        <div class="flat-matrix" id="whole_page" style="background-image: url(assets/self-owned/img/xinyuanka1.jpg);background-repeat: no-repeat;background-size:100% 100%;margin-top:-58px;">
            <div class="app-container">
                <div class="row content-container">
                    <!-- 应用左侧NAV导航，可以应用与assist，帮助，过滤等辅助组件，默认自动收缩扩展，支持悬停（点击右上角按钮切换）-->
                    <div class="container">



                        <!-- logo of the pingan -->
                        <div style="margin-top:58px;">&nbsp;</div>
                        <div>
                            <img id="pinganlogo" class="img-responsive" src="assets/self-owned/img/pingan1.jpg" alt="" style="width:30%;">
                        </div>

                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <div id="validation_div" style="margin:0px 18px">
                            <!--Validation DIV BEGIN-->
                            <div data-bind="visible: hasError" class="alert alert-warning alert-dismissible fresh-color" role="alert">
                                <button type="button" data-bind="click:function(){hasError(!hasError)}" class="close" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <strong>友情提示:</strong>
                                <div id="errorMessagesDIV" data-bind="foreach:errorMessage">
                                    <div data-bind="text:$data"></div>
                                </div>
                            </div>
                            <!--Validation DIV END-->
                        </div>
                        <div id="contentDIV">
                            <div class="row">
                                <div id="img_container" class="img_container_div">
                                    <div class="col-xs-2 col-xs-offset-1 " style="margin-top:30px;" id="plane_image_div">
                                        <div class="text-center" style="width:70px;align:center">
                                            <img src="assets/self-owned/img/xinyuanka/plane.jpg" class="img-circle img_size " id="plane_image" onclick="chooseType('1')"><br>飞机
                                        </div>
                                    </div>
                                    <div class="col-xs-2  " style="margin-top:-13px;margin-left:-10px">
                                        <div class="text-center" style="width:70px;align:center">
                                            <img src="assets/self-owned/img/xinyuanka/car.jpg" class="img-circle img_size " id="car_image" onclick="chooseType('2')"><br>豪车
                                        </div>
                                    </div>
                                    <div class="col-xs-2  " style="margin-top:-30px;">
                                        <div class="text-center" style="width:70px;align:center">
                                            <img src="assets/self-owned/img/xinyuanka/house.jpg" class="img-circle img_size " id="house_image" onclick="chooseType('3')"><br>豪宅
                                        </div>
                                    </div>
                                    <div class="col-xs-2 " style="margin-top:-13px;">
                                        <div class="text-center" style="width:70px;align:center">
                                            <img src="assets/self-owned/img/xinyuanka/travel.jpg" class="img-circle img_size " id="travel_image" onclick="chooseType('4')"><br>全球旅行
                                        </div>
                                    </div>
                                    <div class="col-xs-2  " style="margin-top:30px;">
                                        <div class="text-center" style="width:70px;align:center">
                                            <img src="assets/self-owned/img/xinyuanka/career.jpg" class="img-circle img_size " id="career_image" onclick="chooseType('5')"><br>事业平台
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 text-center">

                                <form class="form-horizontal">
                                    <div class="form-group">
                                        <label class="col-xs-12 ">
                                            <span style="font-weight: bold;font-size: 18px;color:white">2016年我想要......</span>
                                        </label>
                                    </div>
                                    <div class="form-group text-center">
                                        <div class="col-xs-12 text-center" style="overflow: auto">
                                            <textarea data-bind="value:inputContent,valueUpdate:'input'" rows="3" cols="28" placeholder="请在此许下您的心愿"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group ">
                                        <div class="col-xs-12 text-center">
                                            <a class="btn btn-danger  btn-wide text-center" href="#" style="width:260px; color:white" onclick="persist()">分享至内部工作群 </a>
                                        </div>
                                    </div>
                                </form>
                                <br>
                                <br>
                                <br>
                                <br>
                                <br>
                                <br>

                                <div class="" style="color:white;font-size:11px">
                                    <p><strong>本活动最终解释权归中国平安所有</strong> </p>
                                </div>
                            </div>
                        </div>

                    </div>


                </div>
            </div>

        </div>
        <!-- /.container -->


        <script src="assets/reference/jquery/jquery-1.11.1.min.js"></script>
        <script src="assets/reference/jquery/jquery.json.js"></script>
        <script src="assets/reference/knockout.js/knockout-3.3.0.js"></script>
        <script src="assets/reference/jquery-tiny-pubsub/tiny-pubsub.js"></script>
        <script src="assets/reference/flat-ui/js/vendor/video.js"></script>
        <script src="assets/reference/flat-ui/js/flat-ui.min.js"></script>
        <script src="assets/reference/flat-ui/docs/assets/js/prettify.js"></script>
        <script src="assets/reference/flat-ui/docs/assets/js/application.js"></script>
        <!-- Javascript for Matrix Self Owned -->
        <script src="assets/self-owned/js/generic/generic_algorithm.js"></script>
        <script src="assets/self-owned/js/generic/generic_cache.js"></script>
        <script src="assets/self-owned/js/generic/generic_charting.js"></script>
        <script src="assets/self-owned/js/generic/generic_csv.js"></script>
        <script src="assets/self-owned/js/generic/generic_cud.js"></script>
        <script src="assets/self-owned/js/generic/generic_modal.js"></script>
        <script src="assets/self-owned/js/generic/generic_prototype.js"></script>
        <script src="assets/self-owned/js/generic/generic_query.js"></script>
        <script src="assets/self-owned/js/generic/generic_table.js"></script>
        <script src="assets/self-owned/js/generic/generic_util.js"></script>
        <script src="assets/self-owned/js/generic/generic_validation.js"></script>

        <script src="assets/self-owned/js/xinyuanka/xinyuanka.js"></script>

        
        <script>
            function getUserInfo() {
                var query = {"param1": "YINGXIAO_OR_QUTUO"};
                var url = $.getRootPath() + "/api/account/getUserInfo";
                var data = {
                    'queryJson': JSON.stringify(query)
                }


                $.serverRequest(url, data, "XINYUAN_GET_USER_INFO_SUCCESS", "XINYUAN_GET_USER_INFO_RESPONSE_ERROR", "XINYUAN_GET_USER_INFO_SERVER_ERROR", "POST");

                $.subscribe("XINYUAN_GET_USER_INFO_SUCCESS", xinyuanGetUserInfoSuccessListener);
                $.subscribe("XINYUAN_GET_USER_INFO_RESPONSE_ERROR", xinyuanGetUserInfoFailedListener);
                $.subscribe("XINYUAN_GET_USER_INFO_SERVER_ERROR", xinyuanGetUserInfoFailedListener);

            }

            function xinyuanGetUserInfoSuccessListener() {

                if (arguments && arguments[1]) {
                    var resp = arguments[1];
                    var userInfo = eval("(" + resp.result[0] + ")");
                    xinyuanka_3.userInfo(userInfo);
                }
            }

            function xinyuanGetUserInfoFailedListener() {
                console.log("get user failed")
                location.href = $.getRootPath() + '/pingan_jianzhengka_1.html';
            }


        </script>

        <script>
                                            $(document).ready(function () {
                                                environmentCheck();
                                                getUserInfo();
                                            });

                                            var xinyuanka_3 = new Xinyuanka_3();

                                            ko.applyBindings(xinyuanka_3, document.getElementById('contentDIV'));

                                            var environmentCheck = function () {

                                                var tokenFlag = $.hasUrlParam('token');
                                                if (tokenFlag) {
                                                    var token = $.urlParamValue('token');
                                                    var param = UtilPOJO.decode(token);
                                                    var obj = JSON.parse(param);
                                                    if (xinyuanka_3) {
                                                        xinyuanka_3.key_1 = obj.key_1;
                                                        xinyuanka_3.key_2 = obj.key_2;
                                                    }
                                                } else {
                                                }
                                            }
        </script>
        <script>
            var businessValidation = function () {
                var errorMessages = [];
                //validate logic...

                //validate
                ValidationPOJO.validate("您的心愿卡片", xinyuanka_3.dream_type(), errorMessages, ['KEY_NOT_NULL']);
                ValidationPOJO.validate("您的心愿内容", xinyuanka_3.inputContent(), errorMessages, ['KEY_NOT_NULL']);

                return errorMessages;
            }

            var genericModalViewModel = new GenericModalViewModel();
            ko.applyBindings(genericModalViewModel, document.getElementById('validation_div'));

            function persist() {
                if (!genericModalViewModel.validation(businessValidation)) {
                    return;
                } else {
                    // validation correct
                    // do your business...
                    var json = {
                        key_1: xinyuanka_3.key_1,
                        key_2: xinyuanka_3.key_2,
                        dream_type: xinyuanka_3.dream_type(),
                        inputContent: xinyuanka_3.inputContent()
                    }

                    var param = JSON.stringify(json);

                    param = UtilPOJO.encode(param);
                    var shareJson = {
                        'type': 'XinYuanKa',
                        'json': param,
                        'username': xinyuanka_3.userInfo().staff_name,
                        'stringalpha': xinyuanka_3.userInfo().personal_code
                    }
                    var data = {
                        'shareJson': $.toJSON(shareJson)
                    };

                    $.serverRequest($.getServerRoot() + '/service_generic_query/api/share/generate/9999', data, "TOKEN_SUCCESS", "TOKEN_FAILED", "TOKEN_SERVICE_FAILED");

                }

            }
            $.subscribe("TOKEN_SUCCESS", tokenSuccessListener);
            $.subscribe("TOKEN_FAILED", tokenFailedListener);
            $.subscribe("TOKEN_SERVICE_FAILED", tokenServiceListener);

            function tokenSuccessListener() {
                if (arguments && arguments[1]) {
                    window.location.replace($.getRootPath() + '/pingan_xinyuanka_4.html?token=' + arguments[1].result[0]);
                }
            }

            function tokenFailedListener() {
                if (arguments && arguments[1]) {
                    var errorMessage = arguments[1].errorMessage;
                    console.log(errorMessage);
                }
            }

            function tokenServiceListener() {
            }
        </script>
        
    </body>

</html>
